# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
Write a query to display all the customers whose ID is the difference between the salesperson ID of Mc Lyon and 2001.
```sql
select *
from customer
where customer_id = (
  select salesman_id - 2001
  from salesman
  where name = 'Mc Lyon'
)
```

**Output:**

<img width="1181" height="375" alt="image" src="https://github.com/user-attachments/assets/05ce5b4e-3e19-4670-9628-96ab37b8f171" />

**Question 2**
---
From the following tables, write a SQL query to find all the orders issued by the salesman 'Paul Adam'. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

```sql
select o.ord_no, o.purch_amt, o.ord_date, o.customer_id, o.salesman_id
from orders o
join salesman s
on o.salesman_id = s.salesman_id
where s.name = 'Paul Adam'
```

**Output:**

<img width="1167" height="450" alt="image" src="https://github.com/user-attachments/assets/ede58466-e737-4061-86dc-f098d8e8884a" />

**Question 3**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose Address as Delhi and age below 30

```sql
select ID, NAME, AGE, ADDRESS, SALARY
from CUSTOMERS

where ADDRESS = 'Delhi'
  and AGE < 30
group by ID
```

**Output:**

<img width="1107" height="422" alt="image" src="https://github.com/user-attachments/assets/bb397135-47d6-407b-998a-936b996fb846" />


**Question 4**
---
From the following tables write a SQL query to find salespeople who had more than one customer. Return salesman_id and name.



```sql
select s.salesman_id, s.name
from salesman s
join customer c on s.salesman_id = c.salesman_id
group by s.salesman_id, s.name
having COUNT(c.customer_id) > 1
```

**Output:**

<img width="572" height="522" alt="image" src="https://github.com/user-attachments/assets/01b48ca0-8270-4865-9968-d380f9ed2730" />


**Question 5**
---
From the following tables write a SQL query to find all orders generated by London-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.



```sql
select o.ord_no, o.purch_amt, o.ord_date, o.customer_id, o.salesman_id
from orders o
join salesman s
on o.salesman_id = s.salesman_id
where s.city = 'London';
```

**Output:**

<img width="1165" height="457" alt="image" src="https://github.com/user-attachments/assets/90d71e07-f1df-475e-a2b1-4e5dfb6d7160" />


**Question 6**
---
Write a SQL query to Retrieve the names of customers who have a phone number that is not shared with any other customer.



```sql
select name
from customer
where phone IN (
  select phone
  from customer
  group by phone
  having COUNT(*) = 1
)
```

**Output:**

<img width="457" height="508" alt="image" src="https://github.com/user-attachments/assets/35bf942e-4993-48f2-93c2-635ee1e6bc9c" />


**Question 7**
---
Write a SQL query to Retrieve the medications with dosages equal to the highest dosage



```sql
select *
from Medications
where dosage = (select MAX(dosage) from Medications)
```

**Output:**

<img width="802" height="457" alt="image" src="https://github.com/user-attachments/assets/64d5e541-b512-4731-9d05-379c6a89c01c" />


**Question 8**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $1500.



```sql
select *
from CUSTOMERS
where SALARY > 1500;
```

**Output:**

<img width="1140" height="642" alt="image" src="https://github.com/user-attachments/assets/183e335a-3637-4cb2-87d7-2e56047a0e1c" />


**Question 9**
---
Write a SQL query to Retrieve the medications with dosages equal to the lowest dosage



```sql
select rowid as medic, medication_name, dosage
from Medications
where CAST(REPLACE(dosage, 'mg', '') as integer) = (
  select MIN(CAST(REPLACE(dosage, 'mg', '') as integer))
  from Medications
)
```

**Output:**

<img width="826" height="462" alt="image" src="https://github.com/user-attachments/assets/e8e31991-3794-4cd0-86fb-6609f16c8074" />


**Question 10**
---
Write a SQL query to Identify customers whose city is different from the city of the customer with the highest ID



```sql
select *
from customer
where city <> (
  select city
  from customer
  where id = (select MAX(id) from customer)
)
```

**Output:**

<img width="1148" height="473" alt="image" src="https://github.com/user-attachments/assets/db05dfdf-2ce4-437d-8645-f0f951968409" />



## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
